%%% ======================================================================
%%%  @LaTeX-style-file{
%%%     filename        = "nb.sty",
%%%     version         = "<0.35>",
%%%     date            = "Mar 26, 2019",
%%%     author          = "Denis D. Sheka",
%%%     email           = "sheka@knu.ua",
%%%     abstract        = "LaTeX style for commenting document".
%%%
%%% }
%******************** Begin of file "nb.sty" ***************************
%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{nb}[2019/03/26 v0.35 Nota Bene package]
\typeout{*** Nota Bene package 2019/03/26 v0.35 ***}
\RequirePackage{xkeyval}
\RequirePackage{xifthen}
\RequirePackage{xcolor}
\RequirePackage{pgf,tikz}
\RequirePackage{xparse}
%\RequirePackage[textwidth=72pt]{todonotes}
\RequirePackage[most]{tcolorbox}

\newif\ifnbfinal
\DeclareOption{final}{\nbfinaltrue}
\DeclareOption{draft}{\nbfinalfalse}

\ProcessOptionsX*\relax


%\ExecuteOptions{draft}


\newcommand{\alert}[1]{{\color{red}{#1}}}


%newcommand{\stkout}[1]{\ifmmode\text{\sout{\ensuremath{#1}}}\else\sout{#1}\fi}
%\setdeletedmarkup{\stkout{#1}}

%
% Comments in todo style
%
\newtcolorbox{mybox}[2][]{colback=green!5!white,
	colframe=green!50!orange!50!white,fonttitle=\bfseries,
	colbacktitle=green!50!orange!50!white,coltitle=red,enhanced,
	attach boxed title to top center={yshift=-2mm},
	title=#2,#1}
%
\newtcolorbox{myboxnot}[1]{colback=green!5!white,
	colframe=green!50!orange!50!white,fonttitle=\bfseries,
	colbacktitle=green!50!orange!50!white}
%

\NewDocumentCommand{\nb}{s o m o}{
	\IfBooleanTF{#1}
	{
		% margin (star option)
		\todo[noinline,caption={},size=\scriptsize,fancyline,backgroundcolor=green!5!white, bordercolor=green!50!orange!50!white]{
		\IfValueTF{#2}{	
			\textcolor{red}{by #2 
			\IfValueT{#4}{(#4)}}}\par

			#3}
	}
	{
		% inline
		\IfValueTF{#2}{
			\begin{mybox}{by #2 \IfValueT{#4}{(#4)}}
				#3
			\end{mybox}
			
		}{
			\begin{myboxnot}
			~#3
			\end{myboxnot}
		}
	}
}

\ifnbfinal
{
***
}\fi

%\ifthenelse{\equal{\quality}{final}}{
%\RenewDocumentCommand{\nb}{}{}
%}{}

%%% Alternative definition to have the remarks
%%% in the margins instead of footnotes
%\setlength{\marginparwidth}{15mm}
%\makeatletter
%\setremarkmarkup{\todo[color=Changes@Color#1!5!white, bordercolor=Changes@Color#1!20!green!50!orange,fancyline,size=\scriptsize]{\textcolor{red}{by #1}\\#2}}
%\makeatother


% Widen page and margin while keeping other geometry settings (for todo notes)
%
\ifdef{\xtrarightoffset}{\relax}{
\def\xtrarightoffset{0mm}
}

\ifdef{\xtraleftoffset}{\relax}{
\def\xtraleftoffset{0mm}
}

\newlength{\rightoffset}
\setlength{\rightoffset}{\xtrarightoffset}
\newlength{\leftoffset}
\setlength{\leftoffset}{\xtraleftoffset}

\hoffset=\dimexpr \hoffset + \leftoffset\relax
\paperwidth=\dimexpr \paperwidth + \leftoffset+\rightoffset\relax

\marginparwidth=\dimexpr \marginparwidth + \leftoffset\relax



%******************* End of file "nb.sty" ************************
